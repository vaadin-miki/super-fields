name: Merge release notes, create release branch

on:
  check_suite:
    types: [completed]

jobs:
  make-release-branch:
    runs-on: ubuntu-latest
    if: ${{ github.event.check_suite[conclusion] == 'success' && startsWith(github.event.check_suite[head_branch], 'notes-') }}
    steps:
      - name: Merge PR
        uses: UnforgivenPL/merge-pr@v1
        with:
          repository: ${{ github.repository }}
          token: ${{ secrets.GITHUB_TOKEN }}
          pr: ${{ github.event.check_suite[pull_requests][0].number }}
          must-have-labels: release
      - name: Create release branch
        uses: UnforgivenPL/push-branch@v2
        with:
          repository: ${{ github.repository }}
          token: ${{ secrets.ACTIONS_PAT }}
          source: development
          target: release-${{ steps.version.outputs.version }}
